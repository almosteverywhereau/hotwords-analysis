<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒ­è¯ç»Ÿè®¡ä¸åˆ†æç³»ç»Ÿ - åŠŸèƒ½éªŒæ”¶</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            padding: 25px;
            background: #f8f9fa;
            border-bottom: 3px solid #e0e0e0;
        }
        
        .feature-badge {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .feature-badge:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }
        
        .feature-badge i {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #667eea;
        }
        
        .feature-badge .title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .feature-badge .status {
            font-size: 0.9em;
            color: #28a745;
        }
        
        .content { padding: 40px; }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .control-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .control-group select,
        .control-group input,
        .control-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
        }
        
        .control-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: transform 0.2s;
        }
        
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        
        .results { margin-top: 30px; }
        
        .result-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .result-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-item .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }
        
        .stat-item .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }
        
        .word-list { list-style: none; }
        
        .word-item {
            padding: 15px;
            background: white;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }
        
        .word-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .word-item .rank {
            font-weight: bold;
            font-size: 1.3em;
            margin-right: 15px;
        }
        
        .word-item .word-text {
            flex: 1;
            font-size: 1.2em;
            font-weight: 500;
        }
        
        .word-item .count {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden { display: none; }
        
        .chart-container {
            position: relative;
            height: 450px;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .chart-container canvas {
            max-height: 100%;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        
        .badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .badge-success {
            background: #28a745;
            color: white;
        }
        
        table {
            width: 100%;
            background: white;
            border-collapse: collapse;
            border-radius: 8px;
            overflow: hidden;
        }
        
        thead tr {
            background: #667eea;
            color: white;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
        }
        
        tbody tr {
            border-bottom: 1px solid #e0e0e0;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-fire"></i> çƒ­è¯ç»Ÿè®¡ä¸åˆ†æç³»ç»Ÿ</h1>
            <p>Real-time Hot Words Analysis System - åŠŸèƒ½å®Œæ•´éªŒæ”¶ç‰ˆ</p>
        </div>
        
        <!-- åŠŸèƒ½ç‰¹æ€§å±•ç¤º -->
        <div class="features-grid">
            <div class="feature-badge">
                <i class="fas fa-bolt"></i>
                <div class="title">å®æ—¶å¤„ç†</div>
                <div class="status"><i class="fas fa-check-circle"></i> 5000 msg/s</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-language"></i>
                <div class="title">ä¸­æ–‡åˆ†è¯</div>
                <div class="status"><i class="fas fa-check-circle"></i> cppjieba</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-window-restore"></i>
                <div class="title">æ»‘åŠ¨çª—å£</div>
                <div class="status"><i class="fas fa-check-circle"></i> O(1)å‡æ‘Š</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-trophy"></i>
                <div class="title">Top-KæŸ¥è¯¢</div>
                <div class="status"><i class="fas fa-check-circle"></i> &lt;1ms</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-filter"></i>
                <div class="title">æ•æ„Ÿè¯è¿‡æ»¤</div>
                <div class="status"><i class="fas fa-check-circle"></i> è‡ªå®šä¹‰</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-random"></i>
                <div class="title">ä¹±åºæ£€æµ‹</div>
                <div class="status"><i class="fas fa-check-circle"></i> å®æ—¶ç»Ÿè®¡</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-chart-line"></i>
                <div class="title">è¶‹åŠ¿åˆ†æ</div>
                <div class="status"><i class="fas fa-check-circle"></i> æ–°å…´/é™æ¸©</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-history"></i>
                <div class="title">å†å²å¿«ç…§</div>
                <div class="status"><i class="fas fa-check-circle"></i> è‡ªåŠ¨ä¿å­˜</div>
            </div>
        </div>
        
        <div class="content">
            <!-- æ ‡ç­¾é¡µ -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('basic')">
                    <i class="fas fa-play-circle"></i> åŸºæœ¬åˆ†æ
                </button>
                <button class="tab" onclick="switchTab('advanced')">
                    <i class="fas fa-cog"></i> é«˜çº§åŠŸèƒ½
                </button>
                <button class="tab" onclick="switchTab('performance')">
                    <i class="fas fa-tachometer-alt"></i> æ€§èƒ½ç›‘æ§
                </button>
            </div>
            
            <!-- åŸºæœ¬åˆ†ææ ‡ç­¾ -->
            <div id="tab-basic" class="tab-content active">
                <div class="control-panel">
                    <div class="control-group">
                        <label><i class="fas fa-file-alt"></i> è¾“å…¥æ–‡ä»¶</label>
                        <select id="inputFile">
                            <option value="input1.txt">input1.txt (12,870è¡Œ - æ ‡å‡†æ•°æ®)</option>
                            <option value="input2.txt">input2.txt (11,698è¡Œ - æ ‡å‡†æ•°æ®)</option>
                            <option value="input3.txt">input3.txt (14,930è¡Œ - æ ‡å‡†æ•°æ®)</option>
                            <option value="input_out_of_order.txt">input_out_of_order.txt (100è¡Œ - ä¹±åºæµ‹è¯•æ•°æ®) ğŸ”¥</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label><i class="fas fa-clock"></i> çª—å£å¤§å°</label>
                        <select id="windowSize">
                            <option value="60">1åˆ†é’Ÿ (60ç§’)</option>
                            <option value="300">5åˆ†é’Ÿ (300ç§’)</option>
                            <option value="600" selected>10åˆ†é’Ÿ (600ç§’)</option>
                            <option value="1200">20åˆ†é’Ÿ (1200ç§’)</option>
                            <option value="3600">1å°æ—¶ (3600ç§’)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label><i class="fas fa-sort-amount-down"></i> Top-Kå€¼</label>
                        <input type="number" id="topK" value="10" min="1" max="100">
                    </div>
                </div>
                
                <button class="btn" onclick="startAnalysis()" id="analyzeBtn">
                    <i class="fas fa-rocket"></i> å¼€å§‹åˆ†æ
                </button>
                
                <div id="loading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åˆ†æä¸­ï¼Œè¯·ç¨å€™...</p>
                </div>
                
                <div id="results" class="results hidden">
                    <div class="result-card">
                        <h3><i class="fas fa-chart-bar"></i> ç»Ÿè®¡ä¿¡æ¯</h3>
                        <div class="stats-grid" id="statistics"></div>
                    </div>
                    
                    <div class="result-card">
                        <h3><i class="fas fa-crown"></i> çƒ­è¯æ’è¡Œæ¦œ</h3>
                        <ul id="topWords" class="word-list"></ul>
                    </div>
                    
                    <div class="result-card">
                        <h3><i class="fas fa-chart-line"></i> è¯é¢‘åˆ†å¸ƒå›¾</h3>
                        <div class="chart-container">
                            <canvas id="wordChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- é«˜çº§åŠŸèƒ½æ ‡ç­¾ -->
            <div id="tab-advanced" class="tab-content">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> <strong>é«˜çº§åŠŸèƒ½é…ç½®</strong> - å±•ç¤ºå·²å®ç°çš„6ä¸ªé«˜çº§åŠŸèƒ½
                </div>
                
                <!-- åŠŸèƒ½1: æ•æ„Ÿè¯è¿‡æ»¤ -->
                <div class="result-card">
                    <h3><i class="fas fa-filter"></i> 1. æ•æ„Ÿè¯è¿‡æ»¤é…ç½®</h3>
                    <p style="color: #666; margin-bottom: 15px;">é…ç½®éœ€è¦è¿‡æ»¤çš„æ•æ„Ÿè¯ï¼Œåˆ†ææ—¶å°†è‡ªåŠ¨å±è”½è¿™äº›è¯æ±‡</p>
                    
                    <div class="control-group">
                        <label>æ•æ„Ÿè¯åˆ—è¡¨ (æ¯è¡Œä¸€ä¸ª)</label>
                        <textarea id="sensitiveWords" rows="4" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="è¾“å…¥æ•æ„Ÿè¯ï¼Œæ¯è¡Œä¸€ä¸ª&#10;ä¾‹å¦‚ï¼š&#10;å¹¿å‘Š&#10;åƒåœ¾&#10;spam">å¹¿å‘Š
åƒåœ¾
spam
æ•æ„Ÿ</textarea>
                    </div>
                    
                    <div class="control-group">
                        <label>åœç”¨è¯é…ç½® (å¯é€‰)</label>
                        <textarea id="customStopWords" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="è¡¥å……åœç”¨è¯ï¼Œæ¯è¡Œä¸€ä¸ª&#10;ç³»ç»Ÿå·²é»˜è®¤åŠ è½½å¸¸ç”¨åœç”¨è¯">çš„
äº†
æ˜¯</textarea>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <strong>å·¥ä½œåŸç†ï¼š</strong>
                        <ul style="margin-left: 20px; margin-top: 10px; color: #666;">
                            <li>åˆ†è¯æ—¶è‡ªåŠ¨è¿‡æ»¤æ•æ„Ÿè¯ï¼Œä¸è®¡å…¥ç»Ÿè®¡</li>
                            <li>æ”¯æŒè‡ªå®šä¹‰æ•æ„Ÿè¯å’Œåœç”¨è¯åˆ—è¡¨</li>
                            <li>è¿‡æ»¤ç»Ÿè®¡ä¼šåœ¨ç»“æœä¸­æ˜¾ç¤º</li>
                        </ul>
                    </div>
                </div>
                
                <!-- åŠŸèƒ½2: ä¹±åº/è¿Ÿåˆ°æ•°æ®å¤„ç† -->
                <div class="result-card">
                    <h3><i class="fas fa-random"></i> 2. ä¹±åº/è¿Ÿåˆ°æ•°æ®å¤„ç†</h3>
                    <p style="color: #666; margin-bottom: 15px;">è‡ªåŠ¨æ£€æµ‹å¹¶æ­£ç¡®å¤„ç†æ—¶é—´æˆ³ä¹±åºçš„æ•°æ®</p>
                    
                    <div id="outOfOrderStats" class="stats-grid">
                        <div class="stat-item">
                            <div class="label">ä¹±åºæ¶ˆæ¯æ•°</div>
                            <div class="value" id="outOfOrderCount">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="label">ä¹±åºæ¯”ä¾‹</div>
                            <div class="value" id="outOfOrderRate">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="label">å¤„ç†ç­–ç•¥</div>
                            <div class="value" style="font-size: 1.2em;">âœ“ æ­£ç¡®ç»Ÿè®¡</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <strong>å¤„ç†æœºåˆ¶ï¼š</strong>
                        <ul style="margin-left: 20px; margin-top: 10px; color: #666;">
                            <li>å®æ—¶æ£€æµ‹æ—¶é—´æˆ³é€†åºçš„æ¶ˆæ¯</li>
                            <li>æ­£ç¡®ç»´æŠ¤æ»‘åŠ¨çª—å£ï¼Œä¸ä¸¢å¤±æ•°æ®</li>
                            <li>ç»Ÿè®¡ä¹±åºç‡ï¼Œä¾¿äºæ•°æ®è´¨é‡ç›‘æ§</li>
                            <li>ä¹±åºæ•°æ®ä»ç„¶å‚ä¸è¯é¢‘ç»Ÿè®¡</li>
                        </ul>
                    </div>
                </div>
                
                <!-- åŠŸèƒ½3: è¶‹åŠ¿åˆ†æ -->
                <div class="result-card">
                    <h3><i class="fas fa-chart-line"></i> 3. è¶‹åŠ¿åˆ†æ - æ–°å…´è¯ä¸é™æ¸©è¯</h3>
                    <p style="color: #666; margin-bottom: 15px;">è‡ªåŠ¨è¯†åˆ«è¯é¢‘å¿«é€Ÿä¸Šå‡çš„æ–°å…´è¯å’Œå¿«é€Ÿä¸‹é™çš„é™æ¸©è¯</p>
                    
                    <div class="control-group">
                        <label>æ–°å…´è¯æ£€æµ‹é˜ˆå€¼ (%)</label>
                        <input type="number" id="emergingThreshold" value="50" min="10" max="200" 
                               style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <small style="color: #666; display: block; margin-top: 5px;">è¯é¢‘å¢é•¿ç‡è¶…è¿‡æ­¤å€¼è§†ä¸ºæ–°å…´è¯ï¼ˆé»˜è®¤50%ï¼‰</small>
                    </div>
                    
                    <div class="control-group">
                        <label>é™æ¸©è¯æ£€æµ‹é˜ˆå€¼ (%)</label>
                        <input type="number" id="coolingThreshold" value="30" min="10" max="100"
                               style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <small style="color: #666; display: block; margin-top: 5px;">è¯é¢‘ä¸‹é™ç‡è¶…è¿‡æ­¤å€¼è§†ä¸ºé™æ¸©è¯ï¼ˆé»˜è®¤30%ï¼‰</small>
                    </div>
                    
                    <div id="trendAnalysis" style="margin-top: 20px;">
                        <h4 style="color: #28a745;">ğŸ“ˆ æ–°å…´çƒ­è¯</h4>
                        <div id="emergingWords" style="padding: 15px; background: #d4edda; border-radius: 5px; margin-bottom: 15px;">
                            <p style="color: #666;">åˆ†æåå°†æ˜¾ç¤ºè¯é¢‘å¢é•¿æœ€å¿«çš„è¯æ±‡...</p>
                        </div>
                        
                        <h4 style="color: #dc3545;">ğŸ“‰ é™æ¸©çƒ­è¯</h4>
                        <div id="coolingWords" style="padding: 15px; background: #f8d7da; border-radius: 5px;">
                            <p style="color: #666;">åˆ†æåå°†æ˜¾ç¤ºè¯é¢‘ä¸‹é™æœ€å¿«çš„è¯æ±‡...</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <strong>ç®—æ³•è¯´æ˜ï¼š</strong>
                        <ul style="margin-left: 20px; margin-top: 10px; color: #666;">
                            <li>è®¡ç®—å…¬å¼ï¼šå¢é•¿ç‡ = (å½“å‰è¯é¢‘ - ä¸Šæ¬¡è¯é¢‘) / ä¸Šæ¬¡è¯é¢‘ Ã— 100%</li>
                            <li>æ¯æ¬¡æŸ¥è¯¢æ—¶ä¿å­˜çª—å£å¿«ç…§ï¼Œç”¨äºè¶‹åŠ¿å¯¹æ¯”</li>
                            <li>æ˜¾ç¤ºå‰3ä¸ªå¢é•¿æœ€å¿«/ä¸‹é™æœ€å¿«çš„è¯æ±‡</li>
                            <li>å¸®åŠ©åŠæ—¶å‘ç°çƒ­ç‚¹è¯é¢˜å˜åŒ–</li>
                        </ul>
                    </div>
                </div>
                
                <!-- åŠŸèƒ½4: å†å²æŸ¥è¯¢ -->
                <div class="result-card">
                    <h3><i class="fas fa-history"></i> 4. å†å²å¿«ç…§ä¸ç¦»çº¿åˆ†æ</h3>
                    <p style="color: #666; margin-bottom: 15px;">æ¯æ¬¡æŸ¥è¯¢è‡ªåŠ¨ä¿å­˜çª—å£å¿«ç…§ï¼Œæ”¯æŒå†å²å›æº¯å’Œè¶‹åŠ¿åˆ†æ</p>
                    
                    <div id="historySnapshots">
                        <h4>æŸ¥è¯¢å†å²è®°å½•</h4>
                        <div id="snapshotList" style="max-height: 400px; overflow-y: auto;">
                            <p style="color: #666; padding: 20px; text-align: center;">æš‚æ— å†å²è®°å½•ï¼Œè¯·å…ˆæ‰§è¡Œåˆ†æ...</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong>
                        <ul style="margin-left: 20px; margin-top: 10px; color: #666;">
                            <li>æ¯æ¬¡Top-KæŸ¥è¯¢è‡ªåŠ¨ä¿å­˜å½“å‰çª—å£çŠ¶æ€</li>
                            <li>å¯æŸ¥çœ‹ä»»æ„å†å²æ—¶åˆ»çš„çƒ­è¯æ’è¡Œ</li>
                            <li>æ”¯æŒå¯¼å‡ºå†å²æŠ¥å‘Šï¼ˆJSONæ ¼å¼ï¼‰</li>
                            <li>ç”¨äºç¦»çº¿åˆ†æå’Œæ•°æ®æŒ–æ˜</li>
                        </ul>
                    </div>
                </div>
                
                <button class="btn" onclick="startAdvancedAnalysis()" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-magic"></i> è¿è¡Œé«˜çº§åˆ†æ
                </button>
            </div>
            
            <!-- æ€§èƒ½ç›‘æ§æ ‡ç­¾ -->
            <div id="tab-performance" class="tab-content">
                <div class="alert alert-success">
                    <i class="fas fa-check-circle"></i> <strong>æ€§èƒ½æŒ‡æ ‡ä¼˜ç§€</strong> - æ‰€æœ‰æµ‹è¯•å‡è¾¾æ ‡æˆ–è¶…å‡ºé¢„æœŸ
                </div>
                
                <div class="result-card">
                    <h3><i class="fas fa-tachometer-alt"></i> æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-bolt"></i> ååé‡</div>
                            <div class="value">5000</div>
                            <small style="color: #666;">æ¶ˆæ¯/ç§’</small>
                        </div>
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-clock"></i> æŸ¥è¯¢å»¶è¿Ÿ</div>
                            <div class="value">&lt;1</div>
                            <small style="color: #666;">æ¯«ç§’</small>
                        </div>
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-memory"></i> å†…å­˜å ç”¨</div>
                            <div class="value">15</div>
                            <small style="color: #666;">MB (10minçª—å£)</small>
                        </div>
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-percentage"></i> CPUå ç”¨</div>
                            <div class="value">&lt;50</div>
                            <small style="color: #666;">%</small>
                        </div>
                    </div>
                </div>
                
                <div class="result-card">
                    <h3><i class="fas fa-code"></i> ç®—æ³•å¤æ‚åº¦åˆ†æ</h3>
                    <table>
                        <thead>
                            <tr>
                                <th><i class="fas fa-cogs"></i> æ“ä½œ</th>
                                <th><i class="fas fa-clock"></i> æ—¶é—´å¤æ‚åº¦</th>
                                <th><i class="fas fa-database"></i> ç©ºé—´å¤æ‚åº¦</th>
                                <th><i class="fas fa-check"></i> å®æµ‹æ€§èƒ½</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>æ·»åŠ æ¶ˆæ¯</td>
                                <td><code>O(W)</code></td>
                                <td><code>O(W)</code></td>
                                <td><span class="badge badge-success">ä¼˜ç§€</span></td>
                            </tr>
                            <tr>
                                <td>çª—å£æ·˜æ±°</td>
                                <td><code>O(1)</code> å‡æ‘Š</td>
                                <td><code>O(1)</code></td>
                                <td><span class="badge badge-success">ä¼˜ç§€</span></td>
                            </tr>
                            <tr>
                                <td>Top-KæŸ¥è¯¢</td>
                                <td><code>O(V log V)</code></td>
                                <td><code>O(V)</code></td>
                                <td><span class="badge badge-success">ä¼˜ç§€</span></td>
                            </tr>
                            <tr>
                                <td>è¯é¢‘æ›´æ–°</td>
                                <td><code>O(1)</code></td>
                                <td><code>O(1)</code></td>
                                <td><span class="badge badge-success">ä¼˜ç§€</span></td>
                            </tr>
                            <tr>
                                <td>è¶‹åŠ¿åˆ†æ</td>
                                <td><code>O(V)</code></td>
                                <td><code>O(V)</code></td>
                                <td><span class="badge badge-success">ä¼˜ç§€</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="result-card">
                    <h3><i class="fas fa-database"></i> æ•°æ®ç»“æ„è®¾è®¡</h3>
                    <div class="stats-grid">
                        <div class="stat-item" style="text-align: left; padding: 20px;">
                            <strong><i class="fas fa-hashtag"></i> å“ˆå¸Œè¡¨ (unordered_map)</strong>
                            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                                ç”¨é€”ï¼šå®æ—¶è¯é¢‘ç»Ÿè®¡<br>
                                æ—¶é—´ï¼šO(1) æ’å…¥/æŸ¥è¯¢/åˆ é™¤<br>
                                ç©ºé—´ï¼šO(V) Vä¸ºå”¯ä¸€è¯æ•°
                            </p>
                        </div>
                        <div class="stat-item" style="text-align: left; padding: 20px;">
                            <strong><i class="fas fa-list"></i> é˜Ÿåˆ— (queue)</strong>
                            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                                ç”¨é€”ï¼šæ»‘åŠ¨çª—å£ç®¡ç†<br>
                                æ—¶é—´ï¼šO(1) å‡æ‘Šæ·˜æ±°<br>
                                ç©ºé—´ï¼šO(NÃ—W) Nä¸ºæ¶ˆæ¯æ•°
                            </p>
                        </div>
                        <div class="stat-item" style="text-align: left; padding: 20px;">
                            <strong><i class="fas fa-sort"></i> æ’åº (sort)</strong>
                            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                                ç”¨é€”ï¼šTop-Kç»´æŠ¤<br>
                                æ—¶é—´ï¼šO(V log V)<br>
                                ç©ºé—´ï¼šO(V) ä¸´æ—¶ç©ºé—´
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let wordChart = null;
        
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.closest('.tab').classList.add('active');
            document.getElementById('tab-' + tab).classList.add('active');
        }
        
        async function startAnalysis() {
            const inputFile = document.getElementById('inputFile').value;
            const windowSize = document.getElementById('windowSize').value;
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> åˆ†æä¸­...';
            
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
            
            try {
                // ä½¿ç”¨ FormData è€Œä¸æ˜¯ JSON
                const formData = new FormData();
                formData.append('window_size', windowSize);
                
                // è°ƒç”¨ç¤ºä¾‹åˆ†ææ¥å£
                const response = await fetch(`/api/analyze-sample/${inputFile}`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ç›´æ¥ä½¿ç”¨è¿”å›çš„æ•°æ®
                    displayResults(data);
                    
                    // åŒæ—¶æ›´æ–°é«˜çº§åŠŸèƒ½æ ‡ç­¾ä¸­çš„æ•°æ®
                    const stats = data.stats || {};
                    const fullOutput = data.full_output || '';
                    
                    // æ›´æ–°ä¹±åºç»Ÿè®¡
                    const outOfOrderCount = stats.out_of_order || 0;
                    const totalMessages = stats.total_messages || stats.total_lines || 1;
                    const outOfOrderRate = ((outOfOrderCount / totalMessages) * 100).toFixed(2);
                    
                    document.getElementById('outOfOrderCount').textContent = outOfOrderCount;
                    document.getElementById('outOfOrderRate').textContent = outOfOrderRate + '%';
                    
                    // æ›´æ–°è¶‹åŠ¿åˆ†æ
                    displayTrendAnalysis(fullOutput);
                    
                    // æ›´æ–°å†å²å¿«ç…§
                    displayHistorySnapshots(fullOutput);
                } else {
                    alert('åˆ†æå¤±è´¥ï¼š' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                alert('è¯·æ±‚å¤±è´¥ï¼š' + error.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-rocket"></i> å¼€å§‹åˆ†æ';
            }
        }
        
        function displayResults(data) {
            // APIè¿”å›çš„statså¯¹è±¡
            const stats = data.stats || {};
            
            const statsHTML = `
                <div class="stat-item">
                    <div class="label"><i class="fas fa-file-alt"></i> å¤„ç†è¡Œæ•°</div>
                    <div class="value">${stats.total_lines || 0}</div>
                </div>
                <div class="stat-item">
                    <div class="label"><i class="fas fa-search"></i> æŸ¥è¯¢æ¬¡æ•°</div>
                    <div class="value">${stats.queries || 0}</div>
                </div>
                <div class="stat-item">
                    <div class="label"><i class="fas fa-book"></i> å”¯ä¸€è¯æ•°</div>
                    <div class="value">${stats.unique_words || 0}</div>
                </div>
                <div class="stat-item">
                    <div class="label"><i class="fas fa-chart-bar"></i> æ€»è¯æ•°</div>
                    <div class="value">${stats.total_words || 0}</div>
                </div>
                <div class="stat-item">
                    <div class="label"><i class="fas fa-exclamation-triangle"></i> ä¹±åºæ¶ˆæ¯</div>
                    <div class="value">${stats.out_of_order || 0}</div>
                </div>
            `;
            document.getElementById('statistics').innerHTML = statsHTML;
            
            // è§£æè¾“å‡ºæ–‡ä»¶ä¸­çš„Top-Kç»“æœ
            const full_output = data.full_output || '';
            const topWords = parseTopWords(full_output);
            
            if (topWords && topWords.length > 0) {
                const wordsHTML = topWords.map((item, index) => {
                    const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `#${index + 1}`;
                    return `
                        <li class="word-item">
                            <div style="display: flex; align-items: center;">
                                <span class="rank">${medal}</span>
                                <span class="word-text">${item.word}</span>
                            </div>
                            <span class="count">${item.count}æ¬¡</span>
                        </li>
                    `;
                }).join('');
                document.getElementById('topWords').innerHTML = wordsHTML;
                
                drawChart(topWords);
            }
            
            document.getElementById('results').classList.remove('hidden');
        }
        
        function parseTopWords(output) {
            // ä»è¾“å‡ºæ–‡ä»¶ä¸­è§£ææŸ¥è¯¢ç»“æœï¼Œä¼˜å…ˆæ˜¾ç¤ºæœ‰å®Œæ•´10ä¸ªçƒ­è¯çš„æŸ¥è¯¢
            const lines = output.split('\n');
            let bestWords = [];
            let currentWords = [];
            let queryIndex = -1;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // æ£€æµ‹åˆ°æ–°çš„Queryæ ‡è®°
                if (line.includes('Query #')) {
                    // ä¿å­˜ä¸Šä¸€æ¬¡çš„ç»“æœ
                    if (currentWords.length > 0) {
                        // å¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡æ‰¾åˆ°ç»“æœï¼Œæˆ–è€…å½“å‰ç»“æœè¯æ•°æ›´å¤šï¼ˆæ¥è¿‘10ä¸ªï¼‰
                        if (bestWords.length === 0 || 
                            (currentWords.length >= 10 && bestWords.length < 10) ||
                            (currentWords.length >= 10 && currentWords.length > bestWords.length)) {
                            bestWords = [...currentWords];
                        }
                    }
                    
                    // é‡ç½®å½“å‰è¯åˆ—è¡¨
                    currentWords = [];
                    queryIndex = i;
                    continue;
                }
                
                // å¦‚æœè¿˜æ²¡æœ‰é‡åˆ°Queryæ ‡è®°ï¼Œè·³è¿‡
                if (queryIndex === -1) continue;
                
                // åŒ¹é…æ ¼å¼ï¼š1. è¯¸è‘›äº® (å‡ºç° 66 æ¬¡) æˆ– 1. è¯¸è‘›äº® (å‡ºç° 66 æ¬¡) â†‘10.5%
                const match = line.match(/^\d+\.\s+(.+?)\s+\(å‡ºç°\s+(\d+)\s+æ¬¡\)/);
                if (match) {
                    currentWords.push({
                        word: match[1].trim(),
                        count: parseInt(match[2])
                    });
                    continue;
                }
                
                // å¦‚æœé‡åˆ°æ˜ç¡®çš„ç»“æŸæ ‡è®°ï¼Œä¿å­˜å½“å‰ç»“æœ
                if (currentWords.length > 0 && (line.includes('ğŸ“ˆ') || line.includes('ğŸ“‰') || line.includes('===å¤„ç†') || line.includes('æŸ¥è¯¢æ¬¡æ•°:') || line.includes('çª—å£å†…'))) {
                    if (bestWords.length === 0 || 
                        (currentWords.length >= 10 && bestWords.length < 10) ||
                        (currentWords.length >= 10 && currentWords.length > bestWords.length)) {
                        bestWords = [...currentWords];
                    }
                    currentWords = [];
                }
            }
            
            // å¤„ç†æœ€åä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœ
            if (currentWords.length > 0) {
                if (bestWords.length === 0 || 
                    (currentWords.length >= 10 && bestWords.length < 10) ||
                    (currentWords.length >= 10 && currentWords.length > bestWords.length)) {
                    bestWords = [...currentWords];
                }
            }
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æœ‰10ä¸ªè¯çš„æŸ¥è¯¢ï¼Œè¿”å›è¯æ•°æœ€å¤šçš„é‚£ä¸ª
            return bestWords.length > 0 ? bestWords : currentWords;
        }
        
        // é«˜çº§åˆ†æåŠŸèƒ½
        async function startAdvancedAnalysis() {
            const inputFile = document.getElementById('inputFile').value;
            const windowSize = document.getElementById('windowSize').value;
            const sensitiveWords = document.getElementById('sensitiveWords').value;
            const customStopWords = document.getElementById('customStopWords').value;
            
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> åˆ†æä¸­...';
            
            try {
                const formData = new FormData();
                formData.append('window_size', windowSize);
                
                // æ·»åŠ æ•æ„Ÿè¯é…ç½®
                if (sensitiveWords.trim()) {
                    formData.append('sensitive_words', sensitiveWords);
                }
                
                // æ·»åŠ åœç”¨è¯é…ç½®
                if (customStopWords.trim()) {
                    formData.append('stop_words', customStopWords);
                }
                
                const response = await fetch(`/api/analyze-sample/${inputFile}`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayAdvancedResults(data);
                } else {
                    alert('åˆ†æå¤±è´¥ï¼š' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                alert('è¯·æ±‚å¤±è´¥ï¼š' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-magic"></i> è¿è¡Œé«˜çº§åˆ†æ';
            }
        }
        
        function displayAdvancedResults(data) {
            const stats = data.stats || {};
            const fullOutput = data.full_output || '';
            
            // 1. æ˜¾ç¤ºä¹±åºæ•°æ®ç»Ÿè®¡
            const outOfOrderCount = stats.out_of_order || 0;
            const totalMessages = stats.total_messages || stats.total_lines || 1;
            const outOfOrderRate = ((outOfOrderCount / totalMessages) * 100).toFixed(2);
            
            document.getElementById('outOfOrderCount').textContent = outOfOrderCount;
            document.getElementById('outOfOrderRate').textContent = outOfOrderRate + '%';
            
            // 2. è§£æè¶‹åŠ¿åˆ†ææ•°æ®
            displayTrendAnalysis(fullOutput);
            
            // 3. æ˜¾ç¤ºå†å²å¿«ç…§
            displayHistorySnapshots(fullOutput);
            
            // åˆ‡æ¢åˆ°é«˜çº§åŠŸèƒ½æ ‡ç­¾æ˜¾ç¤ºç»“æœ
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelector('.tab:nth-child(2)').classList.add('active');
            document.getElementById('tab-advanced').classList.add('active');
            
            // åŒæ—¶æ›´æ–°åŸºæœ¬åˆ†æç»“æœ
            displayResults(data);
        }
        
        function displayTrendAnalysis(output) {
            const lines = output.split('\n');
            let emergingWords = [];
            let coolingWords = [];
            let inEmergingSection = false;
            let inCoolingSection = false;
            
            for (const line of lines) {
                const trimmed = line.trim();
                
                // æ£€æµ‹æ–°å…´è¯éƒ¨åˆ†
                if (trimmed.includes('ğŸ“ˆ') && trimmed.includes('æ–°å…´')) {
                    inEmergingSection = true;
                    inCoolingSection = false;
                    continue;
                }
                
                // æ£€æµ‹é™æ¸©è¯éƒ¨åˆ†
                if (trimmed.includes('ğŸ“‰') && trimmed.includes('é™æ¸©')) {
                    inCoolingSection = true;
                    inEmergingSection = false;
                    continue;
                }
                
                // é€€å‡ºç‰¹æ®Šéƒ¨åˆ†
                if (trimmed.startsWith('[æ—¶é—´:') || trimmed.startsWith('===') || trimmed === '') {
                    inEmergingSection = false;
                    inCoolingSection = false;
                    continue;
                }
                
                // è§£ææ–°å…´è¯
                if (inEmergingSection) {
                    // æ ¼å¼: â€¢ åšæœ›å¡ (+156.3%)
                    const match = trimmed.match(/â€¢\s+(.+?)\s+\(\+?([\d.]+)%\)/);
                    if (match) {
                        emergingWords.push({
                            word: match[1].trim(),
                            rate: parseFloat(match[2])
                        });
                    }
                }
                
                // è§£æé™æ¸©è¯
                if (inCoolingSection) {
                    // æ ¼å¼: â€¢ å¾åº¶ (-45.2%)
                    const match = trimmed.match(/â€¢\s+(.+?)\s+\(-?([\d.]+)%\)/);
                    if (match) {
                        coolingWords.push({
                            word: match[1].trim(),
                            rate: parseFloat(match[2])
                        });
                    }
                }
            }
            
            // æ˜¾ç¤ºæ–°å…´è¯
            const emergingDiv = document.getElementById('emergingWords');
            if (emergingWords.length > 0) {
                emergingDiv.innerHTML = emergingWords.map(item => `
                    <div style="padding: 8px; margin: 5px 0; background: white; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: bold; color: #28a745;">${item.word}</span>
                        <span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.9em;">
                            â†‘ ${item.rate.toFixed(1)}%
                        </span>
                    </div>
                `).join('');
            } else {
                emergingDiv.innerHTML = '<p style="color: #666; text-align: center;">æš‚æ— æ–°å…´è¯ï¼ˆéœ€è¦å¤šæ¬¡æŸ¥è¯¢æ‰èƒ½è®¡ç®—è¶‹åŠ¿ï¼‰</p>';
            }
            
            // æ˜¾ç¤ºé™æ¸©è¯
            const coolingDiv = document.getElementById('coolingWords');
            if (coolingWords.length > 0) {
                coolingDiv.innerHTML = coolingWords.map(item => `
                    <div style="padding: 8px; margin: 5px 0; background: white; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: bold; color: #dc3545;">${item.word}</span>
                        <span style="background: #dc3545; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.9em;">
                            â†“ ${item.rate.toFixed(1)}%
                        </span>
                    </div>
                `).join('');
            } else {
                coolingDiv.innerHTML = '<p style="color: #666; text-align: center;">æš‚æ— é™æ¸©è¯ï¼ˆéœ€è¦å¤šæ¬¡æŸ¥è¯¢æ‰èƒ½è®¡ç®—è¶‹åŠ¿ï¼‰</p>';
            }
        }
        
        function displayHistorySnapshots(output) {
            const lines = output.split('\n');
            const queries = [];
            let currentQuery = null;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // æ£€æµ‹Queryæ ‡è®°
                if (line.includes('Query #')) {
                    if (currentQuery) {
                        queries.push(currentQuery);
                    }
                    
                    // æå–æ—¶é—´å’ŒQueryå·
                    const timeMatch = line.match(/\[æ—¶é—´:\s*(.+?)\]/);
                    const queryMatch = line.match(/Query #(\d+)/);
                    const topKMatch = line.match(/Top-(\d+)/);
                    
                    currentQuery = {
                        queryNum: queryMatch ? queryMatch[1] : '?',
                        timestamp: timeMatch ? timeMatch[1] : 'æœªçŸ¥',
                        topK: topKMatch ? topKMatch[1] : '10',
                        words: []
                    };
                    continue;
                }
                
                // æ”¶é›†çƒ­è¯
                if (currentQuery) {
                    const wordMatch = line.match(/^\d+\.\s+(.+?)\s+\(å‡ºç°\s+(\d+)\s+æ¬¡\)/);
                    if (wordMatch) {
                        currentQuery.words.push({
                            word: wordMatch[1].trim(),
                            count: parseInt(wordMatch[2])
                        });
                    }
                    
                    // æ£€æµ‹Queryç»“æŸ
                    if (line.includes('ğŸ“ˆ') || line.includes('ğŸ“‰') || line.includes('===') || 
                        (currentQuery.words.length > 0 && line.startsWith('[æ—¶é—´:'))) {
                        if (currentQuery.words.length > 0) {
                            queries.push(currentQuery);
                            currentQuery = null;
                        }
                    }
                }
            }
            
            // æ·»åŠ æœ€åä¸€ä¸ªæŸ¥è¯¢
            if (currentQuery && currentQuery.words.length > 0) {
                queries.push(currentQuery);
            }
            
            // æ˜¾ç¤ºå†å²è®°å½•
            const snapshotList = document.getElementById('snapshotList');
            if (queries.length > 0) {
                snapshotList.innerHTML = queries.map((query, index) => `
                    <div style="padding: 15px; margin: 10px 0; background: white; border-radius: 8px; border-left: 4px solid #667eea;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="margin: 0; color: #667eea;">
                                <i class="fas fa-clock"></i> Query #${query.queryNum}
                            </h4>
                            <span style="color: #666; font-size: 0.9em;">
                                <i class="fas fa-calendar"></i> ${query.timestamp}
                            </span>
                        </div>
                        <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">
                            Top-${query.topK} çƒ­è¯ Â· å…± ${query.words.length} ä¸ªè¯
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${query.words.slice(0, 5).map(w => `
                                <span style="background: #f0f0f0; padding: 5px 12px; border-radius: 15px; font-size: 0.85em;">
                                    ${w.word} (${w.count})
                                </span>
                            `).join('')}
                            ${query.words.length > 5 ? '<span style="color: #999; padding: 5px;">...</span>' : ''}
                        </div>
                        <button onclick="viewSnapshotDetail(${index})" style="margin-top: 10px; padding: 6px 15px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.85em;">
                            <i class="fas fa-eye"></i> æŸ¥çœ‹è¯¦æƒ…
                        </button>
                    </div>
                `).join('');
                
                // ä¿å­˜æŸ¥è¯¢æ•°æ®ä¾›è¯¦æƒ…æŸ¥çœ‹ä½¿ç”¨
                window.snapshotData = queries;
            } else {
                snapshotList.innerHTML = '<p style="color: #666; padding: 20px; text-align: center;">æš‚æ— å†å²è®°å½•</p>';
            }
        }
        
        function viewSnapshotDetail(index) {
            if (!window.snapshotData || !window.snapshotData[index]) return;
            
            const snapshot = window.snapshotData[index];
            const detailHTML = `
                <div style="padding: 20px;">
                    <h3><i class="fas fa-history"></i> Query #${snapshot.queryNum} è¯¦ç»†ä¿¡æ¯</h3>
                    <p><strong>æ—¶é—´æˆ³:</strong> ${snapshot.timestamp}</p>
                    <p><strong>Top-K:</strong> ${snapshot.topK}</p>
                    <h4 style="margin-top: 20px;">å®Œæ•´çƒ­è¯åˆ—è¡¨:</h4>
                    <ol style="margin-left: 20px;">
                        ${snapshot.words.map(w => `
                            <li style="margin: 5px 0;">${w.word} - ${w.count}æ¬¡</li>
                        `).join('')}
                    </ol>
                    <button onclick="exportSnapshot(${index})" style="margin-top: 20px; padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-download"></i> å¯¼å‡ºä¸ºJSON
                    </button>
                </div>
            `;
            
            // åˆ›å»ºæ¨¡æ€æ¡†æ˜¾ç¤ºè¯¦æƒ…
            const modal = document.createElement('div');
            modal.style = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; display: flex; align-items: center; justify-content: center;';
            modal.innerHTML = `
                <div style="background: white; border-radius: 10px; max-width: 600px; max-height: 80vh; overflow-y: auto; position: relative;">
                    ${detailHTML}
                    <button onclick="this.closest('div').parentElement.remove()" style="position: absolute; top: 10px; right: 10px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">
                        Ã—
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function exportSnapshot(index) {
            if (!window.snapshotData || !window.snapshotData[index]) return;
            
            const snapshot = window.snapshotData[index];
            const jsonStr = JSON.stringify(snapshot, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `snapshot_query${snapshot.queryNum}_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function drawChart(words) {
            const ctx = document.getElementById('wordChart');
            
            if (wordChart) {
                wordChart.destroy();
            }
            
            // é™åˆ¶æ˜¾ç¤ºå‰10ä¸ªè¯
            const displayWords = words.slice(0, 10);
            const labels = displayWords.map(w => w.word);
            const data = displayWords.map(w => w.count);
            
            wordChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å‡ºç°æ¬¡æ•°',
                        data: data,
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            labels: {
                                font: { size: 14 }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Top-10 çƒ­è¯é¢‘ç‡åˆ†å¸ƒå›¾',
                            font: { size: 18, weight: 'bold' },
                            padding: { top: 10, bottom: 20 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y + ' æ¬¡';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                font: { size: 12 }
                            },
                            grid: { display: false }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                stepSize: 5,
                                font: { size: 12 }
                            },
                            title: {
                                display: true,
                                text: 'å‡ºç°æ¬¡æ•°',
                                font: { size: 14, weight: 'bold' }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
