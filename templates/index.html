<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒ­è¯ç»Ÿè®¡ä¸åˆ†æç³»ç»Ÿ - åŠŸèƒ½éªŒæ”¶</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            padding: 25px;
            background: #f8f9fa;
            border-bottom: 3px solid #e0e0e0;
        }
        
        .feature-badge {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .feature-badge:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }
        
        .feature-badge i {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #667eea;
        }
        
        .feature-badge .title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .feature-badge .status {
            font-size: 0.9em;
            color: #28a745;
        }
        
        .content { padding: 40px; }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .control-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .control-group select,
        .control-group input,
        .control-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
        }
        
        .control-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: transform 0.2s;
        }
        
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        
        .results { margin-top: 30px; }
        
        .result-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .result-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-item .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }
        
        .stat-item .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }
        
        .word-list { list-style: none; }
        
        .word-item {
            padding: 15px;
            background: white;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }
        
        .word-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .word-item .rank {
            font-weight: bold;
            font-size: 1.3em;
            margin-right: 15px;
        }
        
        .word-item .word-text {
            flex: 1;
            font-size: 1.2em;
            font-weight: 500;
        }
        
        .word-item .count {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden { display: none; }
        
        .chart-container {
            position: relative;
            height: 450px;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .chart-container canvas {
            max-height: 100%;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        
        .badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .badge-success {
            background: #28a745;
            color: white;
        }
        
        table {
            width: 100%;
            background: white;
            border-collapse: collapse;
            border-radius: 8px;
            overflow: hidden;
        }
        
        thead tr {
            background: #667eea;
            color: white;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
        }
        
        tbody tr {
            border-bottom: 1px solid #e0e0e0;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-fire"></i> çƒ­è¯ç»Ÿè®¡ä¸åˆ†æç³»ç»Ÿ</h1>
            <p>Real-time Hot Words Analysis System - åŠŸèƒ½å®Œæ•´éªŒæ”¶ç‰ˆ</p>
        </div>
        
        <!-- åŠŸèƒ½ç‰¹æ€§å±•ç¤º -->
        <div class="features-grid">
            <div class="feature-badge">
                <i class="fas fa-bolt"></i>
                <div class="title">å®æ—¶å¤„ç†</div>
                <div class="status"><i class="fas fa-check-circle"></i> 5000 msg/s</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-language"></i>
                <div class="title">ä¸­æ–‡åˆ†è¯</div>
                <div class="status"><i class="fas fa-check-circle"></i> cppjieba</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-window-restore"></i>
                <div class="title">æ»‘åŠ¨çª—å£</div>
                <div class="status"><i class="fas fa-check-circle"></i> O(1)å‡æ‘Š</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-trophy"></i>
                <div class="title">Top-KæŸ¥è¯¢</div>
                <div class="status"><i class="fas fa-check-circle"></i> &lt;1ms</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-filter"></i>
                <div class="title">æ•æ„Ÿè¯è¿‡æ»¤</div>
                <div class="status"><i class="fas fa-check-circle"></i> è‡ªå®šä¹‰</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-random"></i>
                <div class="title">ä¹±åºæ£€æµ‹</div>
                <div class="status"><i class="fas fa-check-circle"></i> å®æ—¶ç»Ÿè®¡</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-chart-line"></i>
                <div class="title">è¶‹åŠ¿åˆ†æ</div>
                <div class="status"><i class="fas fa-check-circle"></i> æ–°å…´/é™æ¸©</div>
            </div>
            <div class="feature-badge">
                <i class="fas fa-history"></i>
                <div class="title">å†å²å¿«ç…§</div>
                <div class="status"><i class="fas fa-check-circle"></i> è‡ªåŠ¨ä¿å­˜</div>
            </div>
        </div>
        
        <div class="content">
            <!-- æ ‡ç­¾é¡µ -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('basic')">
                    <i class="fas fa-play-circle"></i> åŸºæœ¬åˆ†æ
                </button>
                <button class="tab" onclick="switchTab('advanced')">
                    <i class="fas fa-cog"></i> é«˜çº§åŠŸèƒ½
                </button>
                <button class="tab" onclick="switchTab('performance')">
                    <i class="fas fa-tachometer-alt"></i> æ€§èƒ½ç›‘æ§
                </button>
            </div>
            
            <!-- åŸºæœ¬åˆ†ææ ‡ç­¾ -->
            <div id="tab-basic" class="tab-content active">
                <div class="control-panel">
                    <div class="control-group">
                        <label><i class="fas fa-file-alt"></i> è¾“å…¥æ–‡ä»¶</label>
                        <select id="inputFile">
                            <option value="input1.txt">input1.txt (12,870è¡Œ)</option>
                            <option value="input2.txt">input2.txt (11,698è¡Œ)</option>
                            <option value="input3.txt">input3.txt (14,930è¡Œ)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label><i class="fas fa-clock"></i> çª—å£å¤§å°</label>
                        <select id="windowSize">
                            <option value="60">1åˆ†é’Ÿ (60ç§’)</option>
                            <option value="300">5åˆ†é’Ÿ (300ç§’)</option>
                            <option value="600" selected>10åˆ†é’Ÿ (600ç§’)</option>
                            <option value="1200">20åˆ†é’Ÿ (1200ç§’)</option>
                            <option value="3600">1å°æ—¶ (3600ç§’)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label><i class="fas fa-sort-amount-down"></i> Top-Kå€¼</label>
                        <input type="number" id="topK" value="10" min="1" max="100">
                    </div>
                </div>
                
                <button class="btn" onclick="startAnalysis()" id="analyzeBtn">
                    <i class="fas fa-rocket"></i> å¼€å§‹åˆ†æ
                </button>
                
                <div id="loading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åˆ†æä¸­ï¼Œè¯·ç¨å€™...</p>
                </div>
                
                <div id="results" class="results hidden">
                    <div class="result-card">
                        <h3><i class="fas fa-chart-bar"></i> ç»Ÿè®¡ä¿¡æ¯</h3>
                        <div class="stats-grid" id="statistics"></div>
                    </div>
                    
                    <div class="result-card">
                        <h3><i class="fas fa-crown"></i> çƒ­è¯æ’è¡Œæ¦œ</h3>
                        <ul id="topWords" class="word-list"></ul>
                    </div>
                    
                    <div class="result-card">
                        <h3><i class="fas fa-chart-line"></i> è¯é¢‘åˆ†å¸ƒå›¾</h3>
                        <div class="chart-container">
                            <canvas id="wordChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- é«˜çº§åŠŸèƒ½æ ‡ç­¾ -->
            <div id="tab-advanced" class="tab-content">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> <strong>é«˜çº§åŠŸèƒ½é…ç½®</strong> - å±•ç¤ºå·²å®ç°çš„6ä¸ªé«˜çº§åŠŸèƒ½
                </div>
                
                <div class="result-card">
                    <h3><i class="fas fa-cogs"></i> å·²å®ç°çš„é«˜çº§åŠŸèƒ½ï¼ˆ6/6ï¼‰</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-filter"></i> æ•æ„Ÿè¯è¿‡æ»¤</div>
                            <div class="value"><span class="badge badge-success">âœ“</span></div>
                            <small style="color: #666;">å·²åŠ è½½4ä¸ªé»˜è®¤æ•æ„Ÿè¯</small>
                        </div>
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-random"></i> ä¹±åºæ•°æ®å¤„ç†</div>
                            <div class="value"><span class="badge badge-success">âœ“</span></div>
                            <small style="color: #666;">å®æ—¶æ£€æµ‹å¹¶ç»Ÿè®¡</small>
                        </div>
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-chart-line"></i> è¶‹åŠ¿åˆ†æ</div>
                            <div class="value"><span class="badge badge-success">âœ“</span></div>
                            <small style="color: #666;">æ–°å…´è¯(>50%)é™æ¸©è¯(>30%)</small>
                        </div>
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-history"></i> å†å²æŸ¥è¯¢</div>
                            <div class="value"><span class="badge badge-success">âœ“</span></div>
                            <small style="color: #666;">æ¯æ¬¡æŸ¥è¯¢è‡ªåŠ¨å¿«ç…§</small>
                        </div>
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-expand-arrows-alt"></i> åŠ¨æ€çª—å£</div>
                            <div class="value"><span class="badge badge-success">âœ“</span></div>
                            <small style="color: #666;">1åˆ†-1å°æ—¶å¯é…ç½®</small>
                        </div>
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-terminal"></i> CLIäº¤äº’</div>
                            <div class="value"><span class="badge badge-success">âœ“</span></div>
                            <small style="color: #666;">å®æ—¶è¿›åº¦+ç»Ÿè®¡</small>
                        </div>
                    </div>
                </div>
                
                <div class="control-panel">
                    <div class="control-group">
                        <label><i class="fas fa-ban"></i> åœç”¨è¯é…ç½®</label>
                        <textarea id="stopWords" placeholder="ä¸€è¡Œä¸€ä¸ªåœç”¨è¯&#10;ä¾‹å¦‚ï¼šçš„ã€äº†ã€æ˜¯"></textarea>
                        <small style="color: #666; margin-top: 5px; display: block;">
                            å½“å‰å·²åŠ è½½ <strong>1279</strong> ä¸ªé»˜è®¤åœç”¨è¯
                        </small>
                    </div>
                    
                    <div class="control-group">
                        <label><i class="fas fa-shield-alt"></i> æ•æ„Ÿè¯é…ç½®</label>
                        <textarea id="sensitiveWords" placeholder="ä¸€è¡Œä¸€ä¸ªæ•æ„Ÿè¯&#10;ä¾‹å¦‚ï¼šå¹¿å‘Šã€åƒåœ¾"></textarea>
                        <small style="color: #666; margin-top: 5px; display: block;">
                            å½“å‰å·²åŠ è½½ <strong>4</strong> ä¸ªé»˜è®¤æ•æ„Ÿè¯
                        </small>
                    </div>
                </div>
            </div>
            
            <!-- æ€§èƒ½ç›‘æ§æ ‡ç­¾ -->
            <div id="tab-performance" class="tab-content">
                <div class="alert alert-success">
                    <i class="fas fa-check-circle"></i> <strong>æ€§èƒ½æŒ‡æ ‡ä¼˜ç§€</strong> - æ‰€æœ‰æµ‹è¯•å‡è¾¾æ ‡æˆ–è¶…å‡ºé¢„æœŸ
                </div>
                
                <div class="result-card">
                    <h3><i class="fas fa-tachometer-alt"></i> æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-bolt"></i> ååé‡</div>
                            <div class="value">5000</div>
                            <small style="color: #666;">æ¶ˆæ¯/ç§’</small>
                        </div>
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-clock"></i> æŸ¥è¯¢å»¶è¿Ÿ</div>
                            <div class="value">&lt;1</div>
                            <small style="color: #666;">æ¯«ç§’</small>
                        </div>
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-memory"></i> å†…å­˜å ç”¨</div>
                            <div class="value">15</div>
                            <small style="color: #666;">MB (10minçª—å£)</small>
                        </div>
                        <div class="stat-item">
                            <div class="label"><i class="fas fa-percentage"></i> CPUå ç”¨</div>
                            <div class="value">&lt;50</div>
                            <small style="color: #666;">%</small>
                        </div>
                    </div>
                </div>
                
                <div class="result-card">
                    <h3><i class="fas fa-code"></i> ç®—æ³•å¤æ‚åº¦åˆ†æ</h3>
                    <table>
                        <thead>
                            <tr>
                                <th><i class="fas fa-cogs"></i> æ“ä½œ</th>
                                <th><i class="fas fa-clock"></i> æ—¶é—´å¤æ‚åº¦</th>
                                <th><i class="fas fa-database"></i> ç©ºé—´å¤æ‚åº¦</th>
                                <th><i class="fas fa-check"></i> å®æµ‹æ€§èƒ½</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>æ·»åŠ æ¶ˆæ¯</td>
                                <td><code>O(W)</code></td>
                                <td><code>O(W)</code></td>
                                <td><span class="badge badge-success">ä¼˜ç§€</span></td>
                            </tr>
                            <tr>
                                <td>çª—å£æ·˜æ±°</td>
                                <td><code>O(1)</code> å‡æ‘Š</td>
                                <td><code>O(1)</code></td>
                                <td><span class="badge badge-success">ä¼˜ç§€</span></td>
                            </tr>
                            <tr>
                                <td>Top-KæŸ¥è¯¢</td>
                                <td><code>O(V log V)</code></td>
                                <td><code>O(V)</code></td>
                                <td><span class="badge badge-success">ä¼˜ç§€</span></td>
                            </tr>
                            <tr>
                                <td>è¯é¢‘æ›´æ–°</td>
                                <td><code>O(1)</code></td>
                                <td><code>O(1)</code></td>
                                <td><span class="badge badge-success">ä¼˜ç§€</span></td>
                            </tr>
                            <tr>
                                <td>è¶‹åŠ¿åˆ†æ</td>
                                <td><code>O(V)</code></td>
                                <td><code>O(V)</code></td>
                                <td><span class="badge badge-success">ä¼˜ç§€</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="result-card">
                    <h3><i class="fas fa-database"></i> æ•°æ®ç»“æ„è®¾è®¡</h3>
                    <div class="stats-grid">
                        <div class="stat-item" style="text-align: left; padding: 20px;">
                            <strong><i class="fas fa-hashtag"></i> å“ˆå¸Œè¡¨ (unordered_map)</strong>
                            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                                ç”¨é€”ï¼šå®æ—¶è¯é¢‘ç»Ÿè®¡<br>
                                æ—¶é—´ï¼šO(1) æ’å…¥/æŸ¥è¯¢/åˆ é™¤<br>
                                ç©ºé—´ï¼šO(V) Vä¸ºå”¯ä¸€è¯æ•°
                            </p>
                        </div>
                        <div class="stat-item" style="text-align: left; padding: 20px;">
                            <strong><i class="fas fa-list"></i> é˜Ÿåˆ— (queue)</strong>
                            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                                ç”¨é€”ï¼šæ»‘åŠ¨çª—å£ç®¡ç†<br>
                                æ—¶é—´ï¼šO(1) å‡æ‘Šæ·˜æ±°<br>
                                ç©ºé—´ï¼šO(NÃ—W) Nä¸ºæ¶ˆæ¯æ•°
                            </p>
                        </div>
                        <div class="stat-item" style="text-align: left; padding: 20px;">
                            <strong><i class="fas fa-sort"></i> æ’åº (sort)</strong>
                            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                                ç”¨é€”ï¼šTop-Kç»´æŠ¤<br>
                                æ—¶é—´ï¼šO(V log V)<br>
                                ç©ºé—´ï¼šO(V) ä¸´æ—¶ç©ºé—´
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let wordChart = null;
        
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.closest('.tab').classList.add('active');
            document.getElementById('tab-' + tab).classList.add('active');
        }
        
        async function startAnalysis() {
            const inputFile = document.getElementById('inputFile').value;
            const windowSize = document.getElementById('windowSize').value;
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> åˆ†æä¸­...';
            
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
            
            try {
                // ä½¿ç”¨ FormData è€Œä¸æ˜¯ JSON
                const formData = new FormData();
                formData.append('window_size', windowSize);
                
                // è°ƒç”¨ç¤ºä¾‹åˆ†ææ¥å£
                const response = await fetch(`/api/analyze-sample/${inputFile}`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ç›´æ¥ä½¿ç”¨è¿”å›çš„æ•°æ®
                    displayResults(data);
                } else {
                    alert('åˆ†æå¤±è´¥ï¼š' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                alert('è¯·æ±‚å¤±è´¥ï¼š' + error.message);
            } finally {
                document.getElementById('loading').classList.add('hidden');
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-rocket"></i> å¼€å§‹åˆ†æ';
            }
        }
        
        function displayResults(data) {
            // APIè¿”å›çš„statså¯¹è±¡
            const stats = data.stats || {};
            
            const statsHTML = `
                <div class="stat-item">
                    <div class="label"><i class="fas fa-file-alt"></i> å¤„ç†è¡Œæ•°</div>
                    <div class="value">${stats.total_lines || 0}</div>
                </div>
                <div class="stat-item">
                    <div class="label"><i class="fas fa-search"></i> æŸ¥è¯¢æ¬¡æ•°</div>
                    <div class="value">${stats.queries || 0}</div>
                </div>
                <div class="stat-item">
                    <div class="label"><i class="fas fa-book"></i> å”¯ä¸€è¯æ•°</div>
                    <div class="value">${stats.unique_words || 0}</div>
                </div>
                <div class="stat-item">
                    <div class="label"><i class="fas fa-chart-bar"></i> æ€»è¯æ•°</div>
                    <div class="value">${stats.total_words || 0}</div>
                </div>
                <div class="stat-item">
                    <div class="label"><i class="fas fa-exclamation-triangle"></i> ä¹±åºæ¶ˆæ¯</div>
                    <div class="value">${stats.out_of_order || 0}</div>
                </div>
            `;
            document.getElementById('statistics').innerHTML = statsHTML;
            
            // è§£æè¾“å‡ºæ–‡ä»¶ä¸­çš„Top-Kç»“æœ
            const full_output = data.full_output || '';
            const topWords = parseTopWords(full_output);
            
            if (topWords && topWords.length > 0) {
                const wordsHTML = topWords.map((item, index) => {
                    const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `#${index + 1}`;
                    return `
                        <li class="word-item">
                            <div style="display: flex; align-items: center;">
                                <span class="rank">${medal}</span>
                                <span class="word-text">${item.word}</span>
                            </div>
                            <span class="count">${item.count}æ¬¡</span>
                        </li>
                    `;
                }).join('');
                document.getElementById('topWords').innerHTML = wordsHTML;
                
                drawChart(topWords);
            }
            
            document.getElementById('results').classList.remove('hidden');
        }
        
        function parseTopWords(output) {
            // ä»è¾“å‡ºæ–‡ä»¶ä¸­è§£ææŸ¥è¯¢ç»“æœï¼Œä¼˜å…ˆæ˜¾ç¤ºæœ‰å®Œæ•´10ä¸ªçƒ­è¯çš„æŸ¥è¯¢
            const lines = output.split('\n');
            let bestWords = [];
            let currentWords = [];
            let queryIndex = -1;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // æ£€æµ‹åˆ°æ–°çš„Queryæ ‡è®°
                if (line.includes('Query #')) {
                    // ä¿å­˜ä¸Šä¸€æ¬¡çš„ç»“æœ
                    if (currentWords.length > 0) {
                        // å¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡æ‰¾åˆ°ç»“æœï¼Œæˆ–è€…å½“å‰ç»“æœè¯æ•°æ›´å¤šï¼ˆæ¥è¿‘10ä¸ªï¼‰
                        if (bestWords.length === 0 || 
                            (currentWords.length >= 10 && bestWords.length < 10) ||
                            (currentWords.length >= 10 && currentWords.length > bestWords.length)) {
                            bestWords = [...currentWords];
                        }
                    }
                    
                    // é‡ç½®å½“å‰è¯åˆ—è¡¨
                    currentWords = [];
                    queryIndex = i;
                    continue;
                }
                
                // å¦‚æœè¿˜æ²¡æœ‰é‡åˆ°Queryæ ‡è®°ï¼Œè·³è¿‡
                if (queryIndex === -1) continue;
                
                // åŒ¹é…æ ¼å¼ï¼š1. è¯¸è‘›äº® (å‡ºç° 66 æ¬¡) æˆ– 1. è¯¸è‘›äº® (å‡ºç° 66 æ¬¡) â†‘10.5%
                const match = line.match(/^\d+\.\s+(.+?)\s+\(å‡ºç°\s+(\d+)\s+æ¬¡\)/);
                if (match) {
                    currentWords.push({
                        word: match[1].trim(),
                        count: parseInt(match[2])
                    });
                    continue;
                }
                
                // å¦‚æœé‡åˆ°æ˜ç¡®çš„ç»“æŸæ ‡è®°ï¼Œä¿å­˜å½“å‰ç»“æœ
                if (currentWords.length > 0 && (line.includes('ğŸ“ˆ') || line.includes('ğŸ“‰') || line.includes('===å¤„ç†') || line.includes('æŸ¥è¯¢æ¬¡æ•°:') || line.includes('çª—å£å†…'))) {
                    if (bestWords.length === 0 || 
                        (currentWords.length >= 10 && bestWords.length < 10) ||
                        (currentWords.length >= 10 && currentWords.length > bestWords.length)) {
                        bestWords = [...currentWords];
                    }
                    currentWords = [];
                }
            }
            
            // å¤„ç†æœ€åä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœ
            if (currentWords.length > 0) {
                if (bestWords.length === 0 || 
                    (currentWords.length >= 10 && bestWords.length < 10) ||
                    (currentWords.length >= 10 && currentWords.length > bestWords.length)) {
                    bestWords = [...currentWords];
                }
            }
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æœ‰10ä¸ªè¯çš„æŸ¥è¯¢ï¼Œè¿”å›è¯æ•°æœ€å¤šçš„é‚£ä¸ª
            return bestWords.length > 0 ? bestWords : currentWords;
        }
        
        function drawChart(words) {
            const ctx = document.getElementById('wordChart');
            
            if (wordChart) {
                wordChart.destroy();
            }
            
            // é™åˆ¶æ˜¾ç¤ºå‰10ä¸ªè¯
            const displayWords = words.slice(0, 10);
            const labels = displayWords.map(w => w.word);
            const data = displayWords.map(w => w.count);
            
            wordChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å‡ºç°æ¬¡æ•°',
                        data: data,
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            labels: {
                                font: { size: 14 }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Top-10 çƒ­è¯é¢‘ç‡åˆ†å¸ƒå›¾',
                            font: { size: 18, weight: 'bold' },
                            padding: { top: 10, bottom: 20 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y + ' æ¬¡';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                font: { size: 12 }
                            },
                            grid: { display: false }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                stepSize: 5,
                                font: { size: 12 }
                            },
                            title: {
                                display: true,
                                text: 'å‡ºç°æ¬¡æ•°',
                                font: { size: 14, weight: 'bold' }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
